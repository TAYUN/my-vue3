# Vue 3 å“åº”å¼ç³»ç»Ÿå­¦ä¹ æŒ‡å¯¼æ–‡æ¡£

> ğŸ¯ **ç›®æ ‡**: é€šè¿‡æ‰‹å†™å®ç°æ·±å…¥ç†è§£ Vue 3 å“åº”å¼ç³»ç»Ÿæ ¸å¿ƒåŸç†

---

## ğŸ“‹ å­¦ä¹ å¤§çº²

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å‡†å¤‡ (1-2å¤©)
- [x] é¡¹ç›®ç¯å¢ƒæ­å»º
- [x] å­¦ä¹ æ–‡æ¡£ä½“ç³»å»ºç«‹
- [ ] TypeScript åŸºç¡€å›é¡¾
- [ ] ES6+ æ–°ç‰¹æ€§æŒæ¡

### ç¬¬äºŒé˜¶æ®µï¼šå“åº”å¼æ ¸å¿ƒ (1å‘¨)
- [ ] **Day 1**: Proxy å’Œ Reflect æ·±å…¥ç†è§£
- [ ] **Day 2**: reactive å‡½æ•°å®ç°
- [ ] **Day 3**: effect ç³»ç»Ÿè®¾è®¡
- [ ] **Day 4**: ä¾èµ–æ”¶é›†æœºåˆ¶
- [ ] **Day 5**: è§¦å‘æ›´æ–°é€»è¾‘
- [ ] **Day 6**: åµŒå¥—å¯¹è±¡å¤„ç†
- [ ] **Day 7**: æ•°ç»„å“åº”å¼æ”¯æŒ

### ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§ç‰¹æ€§ (1å‘¨)
- [ ] computed è®¡ç®—å±æ€§
- [ ] watch ç›‘å¬å™¨
- [ ] ref å’Œ reactive çš„åŒºåˆ«
- [ ] æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### ç¬¬å››é˜¶æ®µï¼šå®æˆ˜åº”ç”¨ (1å‘¨)
- [ ] ç®€å•ç»„ä»¶ç³»ç»Ÿ
- [ ] æ¨¡æ¿ç¼–è¯‘åŸºç¡€
- [ ] å®Œæ•´ demo å¼€å‘

---

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒæŒ‡å—

### é¡¹ç›®ç»“æ„è¯´æ˜
```
vue3/
â”œâ”€â”€ packages/                 # æ ¸å¿ƒåŒ…ç›®å½•
â”‚   â”œâ”€â”€ reactivity/          # å“åº”å¼ç³»ç»Ÿ (ä¸»è¦å­¦ä¹ å†…å®¹)
â”‚   â”œâ”€â”€ shared/              # å…±äº«å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ vue/                 # Vue ä¸»åŒ…
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ dev.js              # å¼€å‘æ„å»ºè„šæœ¬
â”œâ”€â”€ Vueå­¦ä¹ æ—¥å¿—.md           # æ¯æ—¥å­¦ä¹ è®°å½•
â”œâ”€â”€ Vueå­¦ä¹ è¿›åº¦.md           # æ•´ä½“è¿›åº¦è·Ÿè¸ª
â”œâ”€â”€ Vueå­¦ä¹ ç¬”è®°.md           # è¯¦ç»†å­¦ä¹ ç¬”è®°
â””â”€â”€ Vueå­¦ä¹ æŒ‡å¯¼æ–‡æ¡£.md       # æœ¬æŒ‡å¯¼æ–‡æ¡£
```

### å¼€å‘å‘½ä»¤
```bash
# å¯åŠ¨å¼€å‘æ¨¡å¼ (ç›‘å¬æ–‡ä»¶å˜åŒ–ï¼Œè‡ªåŠ¨æ„å»º)
pnpm dev

# æ ¼å¼åŒ–ä»£ç 
npx prettier --write .

# TypeScript ç±»å‹æ£€æŸ¥
npx tsc --noEmit
```

---

## ğŸ“š å­¦ä¹ è·¯å¾„è¯¦è§£

### é˜¶æ®µä¸€ï¼šç¯å¢ƒå‡†å¤‡

#### 1.1 TypeScript åŸºç¡€å›é¡¾
**é‡ç‚¹æ¦‚å¿µ**:
- åŸºç¡€ç±»å‹ï¼š`string`, `number`, `boolean`, `object`
- æ³›å‹ï¼š`<T>`, `keyof`, `typeof`
- å·¥å…·ç±»å‹ï¼š`Partial<T>`, `Required<T>`, `Record<K,V>`

**å®è·µä»»åŠ¡**:
```typescript
// ç»ƒä¹ ï¼šä¸ºå“åº”å¼ç³»ç»Ÿå®šä¹‰ç±»å‹
type Target = Record<string | symbol, any>
type Dep = Set<ReactiveEffect>
type KeyToDepMap = Map<any, Dep>
type TargetMap = WeakMap<any, KeyToDepMap>
```

#### 1.2 ES6+ æ–°ç‰¹æ€§
**å¿…é¡»æŒæ¡**:
- `Proxy` å’Œ `Reflect`
- `WeakMap` å’Œ `Map`
- `Set` æ•°æ®ç»“æ„
- è§£æ„èµ‹å€¼å’Œæ‰©å±•è¿ç®—ç¬¦

### é˜¶æ®µäºŒï¼šå“åº”å¼æ ¸å¿ƒå®ç°

#### 2.1 Proxy åŸºç¡€ (Day 1)
**å­¦ä¹ ç›®æ ‡**: æ·±å…¥ç†è§£ Proxy çš„å·¥ä½œåŸç†

**æ ¸å¿ƒçŸ¥è¯†ç‚¹**:
```javascript
// Proxy çš„åŸºæœ¬ç”¨æ³•
const proxy = new Proxy(target, {
  get(target, key, receiver) {
    console.log(`è®¿é—®å±æ€§: ${key}`)
    return Reflect.get(target, key, receiver)
  },
  set(target, key, value, receiver) {
    console.log(`è®¾ç½®å±æ€§: ${key} = ${value}`)
    return Reflect.set(target, key, value, receiver)
  }
})
```

**å®è·µä»»åŠ¡**:
1. åˆ›å»º `packages/reactivity/src/baseHandlers.ts`
2. å®ç°åŸºç¡€çš„ get å’Œ set å¤„ç†å™¨
3. æµ‹è¯•ä¸åŒæ•°æ®ç±»å‹çš„ä»£ç†è¡Œä¸º

#### 2.2 reactive å‡½æ•° (Day 2)
**å­¦ä¹ ç›®æ ‡**: å®ç°åˆ›å»ºå“åº”å¼å¯¹è±¡çš„æ ¸å¿ƒå‡½æ•°

**å®ç°æ­¥éª¤**:
1. åˆ›å»º `packages/reactivity/src/reactive.ts`
2. å®ç°åŸºç¡€çš„ reactive å‡½æ•°
3. å¤„ç†é‡å¤ä»£ç†çš„æƒ…å†µ
4. æ·»åŠ ç±»å‹å®šä¹‰

**æ ¸å¿ƒä»£ç ç»“æ„**:
```typescript
// reactive.ts
export function reactive<T extends object>(target: T): T {
  return createReactiveObject(target, mutableHandlers)
}

function createReactiveObject(target: object, baseHandlers: ProxyHandler<any>) {
  // å®ç°é€»è¾‘
}
```

#### 2.3 effect ç³»ç»Ÿ (Day 3)
**å­¦ä¹ ç›®æ ‡**: å®ç°å‰¯ä½œç”¨å‡½æ•°çš„è‡ªåŠ¨æ‰§è¡Œæœºåˆ¶

**å…³é”®æ¦‚å¿µ**:
- å…¨å±€ effect æ ˆ
- effect çš„åµŒå¥—å¤„ç†
- cleanup æœºåˆ¶

**å®ç°æ–‡ä»¶**: `packages/reactivity/src/effect.ts`

#### 2.4 ä¾èµ–æ”¶é›† (Day 4)
**å­¦ä¹ ç›®æ ‡**: å®ç° track å‡½æ•°ï¼Œå»ºç«‹æ•°æ®ä¸ effect çš„å…³è”

**æ•°æ®ç»“æ„è®¾è®¡**:
```
targetMap (WeakMap)
â”œâ”€â”€ target1 (object)
â”‚   â””â”€â”€ depsMap (Map)
â”‚       â”œâ”€â”€ key1 â†’ Set<effect1, effect2>
â”‚       â””â”€â”€ key2 â†’ Set<effect3>
â””â”€â”€ target2 (object)
    â””â”€â”€ depsMap (Map)
        â””â”€â”€ key1 â†’ Set<effect4>
```

#### 2.5 è§¦å‘æ›´æ–° (Day 5)
**å­¦ä¹ ç›®æ ‡**: å®ç° trigger å‡½æ•°ï¼Œå½“æ•°æ®å˜åŒ–æ—¶æ‰§è¡Œç›¸å…³ effect

**æ ¸å¿ƒé€»è¾‘**:
1. æ ¹æ® target å’Œ key æ‰¾åˆ°å¯¹åº”çš„ effects
2. éå†æ‰§è¡Œæ‰€æœ‰ç›¸å…³çš„ effect
3. å¤„ç†æ‰§è¡Œé¡ºåºå’Œå»é‡

#### 2.6 åµŒå¥—å¯¹è±¡ (Day 6)
**å­¦ä¹ ç›®æ ‡**: å¤„ç†æ·±å±‚åµŒå¥—å¯¹è±¡çš„å“åº”å¼

**æŒ‘æˆ˜**:
- é€’å½’ä»£ç†åµŒå¥—å¯¹è±¡
- æ€§èƒ½ä¼˜åŒ–ï¼šæ‡’ä»£ç†
- å¾ªç¯å¼•ç”¨å¤„ç†

#### 2.7 æ•°ç»„æ”¯æŒ (Day 7)
**å­¦ä¹ ç›®æ ‡**: å®Œå–„æ•°ç»„çš„å“åº”å¼æ”¯æŒ

**ç‰¹æ®Šå¤„ç†**:
- æ•°ç»„ç´¢å¼•çš„ track å’Œ trigger
- æ•°ç»„æ–¹æ³•çš„é‡å†™ (`push`, `pop`, `splice` ç­‰)
- length å±æ€§çš„ç‰¹æ®Šå¤„ç†

---

## ğŸ¯ æ¯æ—¥å­¦ä¹ è®¡åˆ’

### å­¦ä¹ æ—¶é—´å®‰æ’
- **å·¥ä½œæ—¥**: æ¯å¤© 1-2 å°æ—¶
- **å‘¨æœ«**: æ¯å¤© 3-4 å°æ—¶
- **æ€»è®¡**: æ¯å‘¨ 10-14 å°æ—¶

### æ¯æ—¥å­¦ä¹ æµç¨‹

#### 1. å¼€å§‹å­¦ä¹  (10åˆ†é’Ÿ)
- å›é¡¾ä¸Šæ¬¡å­¦ä¹ å†…å®¹
- æŸ¥çœ‹ä»Šæ—¥å­¦ä¹ ç›®æ ‡
- å‡†å¤‡å¼€å‘ç¯å¢ƒ

#### 2. ç†è®ºå­¦ä¹  (30-40åˆ†é’Ÿ)
- é˜…è¯»ç›¸å…³æ–‡æ¡£å’Œèµ„æ–™
- ç†è§£æ ¸å¿ƒæ¦‚å¿µå’ŒåŸç†
- è®°å½•é‡ç‚¹çŸ¥è¯†ç‚¹

#### 3. å®è·µç¼–ç  (40-60åˆ†é’Ÿ)
- æŒ‰ç…§æŒ‡å¯¼å®ç°ä»£ç 
- ç¼–å†™æµ‹è¯•ç”¨ä¾‹
- è°ƒè¯•å’ŒéªŒè¯åŠŸèƒ½

#### 4. æ€»ç»“è®°å½• (10-15åˆ†é’Ÿ)
- æ›´æ–°å­¦ä¹ æ—¥å¿—
- è®°å½•é‡åˆ°çš„é—®é¢˜
- åˆ¶å®šä¸‹æ¬¡å­¦ä¹ è®¡åˆ’

---

## ğŸ§ª æµ‹è¯•é©±åŠ¨å­¦ä¹ 

### æµ‹è¯•æ–‡ä»¶ç»“æ„
```
packages/reactivity/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ reactive.ts
â”‚   â”œâ”€â”€ effect.ts
â”‚   â””â”€â”€ index.ts
â””â”€â”€ __tests__/
    â”œâ”€â”€ reactive.spec.ts
    â”œâ”€â”€ effect.spec.ts
    â””â”€â”€ integration.spec.ts
```

### æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹
```typescript
// reactive.spec.ts
describe('reactive', () => {
  test('åŸºç¡€å“åº”å¼å¯¹è±¡', () => {
    const original = { foo: 1 }
    const observed = reactive(original)
    
    expect(observed).not.toBe(original)
    expect(observed.foo).toBe(1)
  })
  
  test('åµŒå¥—å¯¹è±¡å“åº”å¼', () => {
    const original = { nested: { foo: 1 } }
    const observed = reactive(original)
    
    expect(isReactive(observed.nested)).toBe(true)
  })
})
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æ—¥å¿—è°ƒè¯•
```typescript
// åœ¨å…³é”®ä½ç½®æ·»åŠ æ—¥å¿—
function track(target: object, key: unknown) {
  console.log(`[TRACK] ${target.constructor.name}.${String(key)}`)
  // ... å®ç°é€»è¾‘
}

function trigger(target: object, key: unknown) {
  console.log(`[TRIGGER] ${target.constructor.name}.${String(key)}`)
  // ... å®ç°é€»è¾‘
}
```

### 2. å¯è§†åŒ–ä¾èµ–å…³ç³»
```typescript
// æ·»åŠ è°ƒè¯•å·¥å…·å‡½æ•°
function debugTargetMap() {
  console.log('=== ä¾èµ–å…³ç³»å›¾ ===')
  targetMap.forEach((depsMap, target) => {
    console.log(`Target: ${target.constructor.name}`)
    depsMap.forEach((dep, key) => {
      console.log(`  ${String(key)}: ${dep.size} effects`)
    })
  })
}
```

### 3. æ–­ç‚¹è°ƒè¯•
- åœ¨ get/set é™·é˜±ä¸­è®¾ç½®æ–­ç‚¹
- è§‚å¯Ÿ activeEffect çš„å˜åŒ–
- æ£€æŸ¥ targetMap çš„ç»“æ„

---

## ğŸ“– å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£
- [Vue 3 å®˜æ–¹æ–‡æ¡£](https://vuejs.org/)
- [Vue 3 å“åº”å¼ API](https://vuejs.org/api/reactivity-core.html)
- [TypeScript å®˜æ–¹æ–‡æ¡£](https://www.typescriptlang.org/)

### æºç å­¦ä¹ 
- [Vue 3 GitHub ä»“åº“](https://github.com/vuejs/core)
- [å“åº”å¼ç³»ç»Ÿæºç ](https://github.com/vuejs/core/tree/main/packages/reactivity)

### æ¨èæ–‡ç« 
- ã€ŠVue 3 å“åº”å¼åŸç†æ·±åº¦è§£æã€‹
- ã€Šä»é›¶å®ç° Vue 3 å“åº”å¼ç³»ç»Ÿã€‹
- ã€ŠProxy vs Object.definePropertyã€‹

---

## â“ å¸¸è§é—®é¢˜è§£ç­”

### Q1: ä¸ºä»€ä¹ˆä½¿ç”¨ WeakMap è€Œä¸æ˜¯ Mapï¼Ÿ
**A**: WeakMap çš„é”®æ˜¯å¼±å¼•ç”¨ï¼Œå½“å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œå¯¹åº”çš„ä¾èµ–å…³ç³»ä¹Ÿä¼šè‡ªåŠ¨æ¸…ç†ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚

### Q2: effect åµŒå¥—æ—¶å¦‚ä½•å¤„ç†ï¼Ÿ
**A**: ä½¿ç”¨ effect æ ˆæ¥ç®¡ç†åµŒå¥—å…³ç³»ï¼Œç¡®ä¿å†…å±‚ effect æ‰§è¡Œå®Œåèƒ½æ­£ç¡®æ¢å¤å¤–å±‚çš„ activeEffectã€‚

### Q3: å¦‚ä½•é¿å…æ— é™å¾ªç¯æ›´æ–°ï¼Ÿ
**A**: åœ¨ trigger æ—¶æ£€æŸ¥å½“å‰æ‰§è¡Œçš„ effect æ˜¯å¦å°±æ˜¯è§¦å‘æ›´æ–°çš„ effectï¼Œå¦‚æœæ˜¯åˆ™è·³è¿‡æ‰§è¡Œã€‚

### Q4: æ•°ç»„çš„ length å±æ€§å¦‚ä½•å¤„ç†ï¼Ÿ
**A**: å½“æ•°ç»„å…ƒç´ å˜åŒ–æ—¶ï¼Œéœ€è¦åŒæ—¶ trigger length å±æ€§ï¼›å½“ length å˜åŒ–æ—¶ï¼Œéœ€è¦ trigger æ‰€æœ‰å¯èƒ½å—å½±å“çš„ç´¢å¼•ã€‚

---

## ğŸ‰ å­¦ä¹ é‡Œç¨‹ç¢‘

### é‡Œç¨‹ç¢‘ 1: åŸºç¡€å“åº”å¼ âœ…
- [ ] å®ç°åŸºç¡€ reactive å‡½æ•°
- [ ] å®ç°ç®€å•çš„ effect ç³»ç»Ÿ
- [ ] å®Œæˆç¬¬ä¸€ä¸ªå“åº”å¼ demo

### é‡Œç¨‹ç¢‘ 2: å®Œæ•´åŠŸèƒ½
- [ ] æ”¯æŒåµŒå¥—å¯¹è±¡
- [ ] æ”¯æŒæ•°ç»„å“åº”å¼
- [ ] å®ç° computed å’Œ watch

### é‡Œç¨‹ç¢‘ 3: æ€§èƒ½ä¼˜åŒ–
- [ ] å®ç°æ‡’ä»£ç†
- [ ] ä¼˜åŒ–ä¾èµ–æ”¶é›†
- [ ] æ·»åŠ æ€§èƒ½æµ‹è¯•

### é‡Œç¨‹ç¢‘ 4: å®æˆ˜åº”ç”¨
- [ ] æ„å»ºç®€å•ç»„ä»¶ç³»ç»Ÿ
- [ ] å¼€å‘å®Œæ•´åº”ç”¨ demo
- [ ] æ€§èƒ½å¯¹æ¯”åˆ†æ

---

## ğŸ“ å­¦ä¹ è®°å½•æ¨¡æ¿

### æ¯æ—¥å­¦ä¹ è®°å½•
```markdown
### YYYY-MM-DD (å‘¨X) - [å­¦ä¹ ä¸»é¢˜]

**å­¦ä¹ æ—¶é—´**: Xå°æ—¶
**å®Œæˆå†…å®¹**:
- [ ] ç†è®ºå­¦ä¹ ï¼šXXX
- [ ] ä»£ç å®ç°ï¼šXXX
- [ ] æµ‹è¯•éªŒè¯ï¼šXXX

**é‡ç‚¹æ”¶è·**:
1. 
2. 
3. 

**é‡åˆ°é—®é¢˜**:
- **é—®é¢˜**: 
  **è§£å†³æ–¹æ¡ˆ**: 

**ä¸‹æ¬¡è®¡åˆ’**:
- 

**ä»£ç æäº¤**: `git commit -m "feat: å®ç°XXXåŠŸèƒ½"`
```

---

## ğŸš€ å¼€å§‹ä½ çš„å­¦ä¹ ä¹‹æ—…

1. **ä»Šå¤©å°±å¼€å§‹**: ä¸è¦ç­‰åˆ°å®Œç¾çš„æ—¶æœºï¼Œç°åœ¨å°±æ˜¯æœ€å¥½çš„å¼€å§‹
2. **ä¿æŒèŠ‚å¥**: æ¯å¤©åšæŒå­¦ä¹ ï¼Œå“ªæ€•åªæœ‰30åˆ†é’Ÿ
3. **åŠ¨æ‰‹å®è·µ**: ç†è®ºç»“åˆå®è·µï¼Œå¤šå†™ä»£ç å¤šæµ‹è¯•
4. **è®°å½•æ€»ç»“**: åŠæ—¶è®°å½•å­¦ä¹ å¿ƒå¾—ï¼Œæ–¹ä¾¿åç»­å›é¡¾
5. **é‡åˆ°å›°éš¾ä¸æ”¾å¼ƒ**: ç¼–ç¨‹å­¦ä¹ æœ¬å°±ä¸æ˜“ï¼ŒåšæŒå°±æ˜¯èƒœåˆ©

**è®°ä½**: ä½ ä¸æ˜¯åœ¨å­¦ä¹ ä¸€ä¸ªæ¡†æ¶ï¼Œè€Œæ˜¯åœ¨ç†è§£ç°ä»£å‰ç«¯å¼€å‘çš„æ ¸å¿ƒæ€æƒ³ï¼

---

*åˆ›å»ºæ—¥æœŸï¼š2025-07-20*  
*æœ€åæ›´æ–°ï¼š2025-07-20*